import { languages, visitTypes } from "../config/constant";
// import * as moment from 'moment';
import moment from 'moment';
import { DecimalPipe } from "@angular/common";
// import { environment } from "../../../../src/environments/environment";
export function getCacheData(parse, key) {
    if (parse) {
        try {
            return JSON.parse(localStorage.getItem(key));
        }
        catch (error) {
            return null;
        }
    }
    else {
        return localStorage.getItem(key);
    }
}
export function setCacheData(key, value) {
    localStorage.setItem(key, value);
}
export function deleteCacheData(key) {
    localStorage.removeItem(key);
}
export function isJsonString(str) {
    try {
        const json = JSON.parse(str);
        return (typeof json === 'object');
    }
    catch (e) {
        return false;
    }
}
export function getEncounterProviderUUID() {
    return getCacheData(true, visitTypes.VISIT_NOTE_PROVIDER).encounterProviders[0].provider.uuid;
}
export function getEncounterUUID() {
    return getCacheData(true, visitTypes.VISIT_NOTE_PROVIDER).uuid;
}
/**
  * Check how old the date is from now
  * @param {string} data - Date in string format
  * @return {string} - Returns how old the date is from now
  */
export function checkIfDateOldThanOneDay(data) {
    let hours = moment(data).diff(moment(), 'hours');
    let minutes = moment(data).diff(moment(), 'minutes');
    minutes = minutes - (hours * 60);
    let resString = "";
    if (hours >= 24) {
        resString = moment(data).format('DD MMM, YYYY hh:mm A');
    }
    else {
        if (hours > 1) {
            resString += hours + " Hours";
        }
        else if (hours === 1) {
            resString += hours + " Hour";
        }
        if (minutes < 0) {
            resString = `Due : ${moment(data).format('DD MMM, YYYY hh:mm A')}`;
        }
        else if (minutes === 1) {
            resString += " " + minutes + " Minute";
        }
        else {
            resString += " " + minutes + " Minutes";
        }
    }
    return resString.trim();
}
/**
  * Compare data for sorting
  * @param {number|string} a
  * @param {number|string} b
  * @param {boolean} isAsc
  * @return {number} - Returns order as 1 or -1
  */
export function compare(a, b, isAsc) {
    return (a < b ? -1 : 1) * (isAsc ? 1 : -1);
}
/**
* Get speciality
* @param {ProviderAttributeModel[]} attr - Array of provider attributes
* @return {string} - Speciality
*/
export function getSpecialization(attr = []) {
    let specialization = '';
    for (const a of attr) {
        if (a.attributeType.uuid == 'ed1715f5-93e2-404e-b3c9-2a2d9600f062' && !a.voided) {
            specialization = a.value;
            break;
        }
    }
    return specialization;
}
export function getFieldValueByLanguage(element) {
    const selectedLanguage = getCacheData(false, languages.SELECTED_LANGUAGE);
    // Check if selected language exists in the lang object and is not empty
    if (element?.lang?.[selectedLanguage]?.trim()) {
        return element.lang[selectedLanguage].trim();
    }
    // Return the first non-empty language value
    for (const langValue of Object.values(element?.lang || {})) {
        if (langValue.trim()) {
            return langValue.trim();
        }
    }
    // Fallback to element.name if no valid language value found or element is invalid
    return element?.name || "";
}
export function calculateBMI(vitals, vitalObs, _locale = 'en') {
    const heightUUID = vitals?.find((v) => v.key === 'height_cm')?.uuid;
    const weightUUID = vitals?.find((v) => v.key === 'weight_kg')?.uuid;
    let height = null, weight = null;
    if (heightUUID && weightUUID) {
        height = vitalObs.find((e) => e.concept.uuid === heightUUID)?.value;
        weight = vitalObs.find((e) => e.concept.uuid === weightUUID)?.value;
    }
    if (height && weight) {
        const decimalPipe = new DecimalPipe(_locale);
        return decimalPipe.transform(weight / ((height / 100) * (height / 100)), "1.2-2");
    }
    return null;
}
export function getCallDuration(given_seconds) {
    let dateObj = new Date(given_seconds * 1000);
    let hours = dateObj.getUTCHours();
    let minutes = dateObj.getUTCMinutes();
    let seconds = dateObj.getSeconds();
    return hours.toString().padStart(2, '0') + ':' +
        minutes.toString().padStart(2, '0') + ':' +
        seconds.toString().padStart(2, '0');
}
export function autoGrowTextZone(e) {
    e.target.style.height = "0px";
    e.target.style.height = (e.target.scrollHeight + 5) + "px";
}
export function autoGrowAllTextAreaZone(e) {
    e.forEach(element => {
        element.style.height = (element.scrollHeight + 5) + "px";
    });
}
export function obsStringify(obs) {
    try {
        delete obs['uuid'];
        Object.keys(obs).forEach((k) => obs[k] == null && delete obs[k]);
        return JSON.stringify(obs);
    }
    catch (error) {
        return "";
    }
}
export function obsParse(obs, uuid = "") {
    try {
        if (uuid)
            return { uuid: uuid, ...JSON.parse(obs) };
        else
            return { ...JSON.parse(obs) };
    }
    catch (error) {
        return { uuid: uuid };
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbGl0eS1mdW5jdGlvbnMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9saWItcHJlc2NpcHRpb24vc3JjL2xpYi91dGlscy91dGlsaXR5LWZ1bmN0aW9ucy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBQzNELG9DQUFvQztBQUNwQyxPQUFPLE1BQU0sTUFBTSxRQUFRLENBQUM7QUFFNUIsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQzlDLDBFQUEwRTtBQUUxRSxNQUFNLFVBQVUsWUFBWSxDQUFDLEtBQWMsRUFBRSxHQUFXO0lBQ3RELElBQUksS0FBSyxFQUFFO1FBQ1QsSUFBSTtZQUNGLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxZQUFZLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7U0FDOUM7UUFBQyxPQUFPLEtBQUssRUFBRTtZQUNkLE9BQU8sSUFBSSxDQUFBO1NBQ1o7S0FDRjtTQUFNO1FBQ0wsT0FBTyxZQUFZLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0tBQ2xDO0FBQ0gsQ0FBQztBQUVELE1BQU0sVUFBVSxZQUFZLENBQUMsR0FBVyxFQUFFLEtBQWE7SUFDckQsWUFBWSxDQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUUsS0FBSyxDQUFDLENBQUM7QUFDbkMsQ0FBQztBQUVELE1BQU0sVUFBVSxlQUFlLENBQUMsR0FBVztJQUN6QyxZQUFZLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0FBQy9CLENBQUM7QUFFRCxNQUFNLFVBQVUsWUFBWSxDQUFDLEdBQUc7SUFDOUIsSUFBSTtRQUNGLE1BQU0sSUFBSSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDN0IsT0FBTyxDQUFDLE9BQU8sSUFBSSxLQUFLLFFB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cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgbGFuZ3VhZ2VzLCB2aXNpdFR5cGVzIH0gZnJvbSBcIi4uL2NvbmZpZy9jb25zdGFudFwiO1xyXG4vLyBpbXBvcnQgKiBhcyBtb21lbnQgZnJvbSAnbW9tZW50JztcclxuaW1wb3J0IG1vbWVudCBmcm9tICdtb21lbnQnO1xyXG5pbXBvcnQgeyBQcm92aWRlckF0dHJpYnV0ZU1vZGVsIH0gZnJvbSBcIi4uL21vZGVsL21vZGVsXCI7XHJcbmltcG9ydCB7IERlY2ltYWxQaXBlIH0gZnJvbSBcIkBhbmd1bGFyL2NvbW1vblwiO1xyXG4vLyBpbXBvcnQgeyBlbnZpcm9ubWVudCB9IGZyb20gXCIuLi8uLi8uLi8uLi9zcmMvZW52aXJvbm1lbnRzL2Vudmlyb25tZW50XCI7XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0Q2FjaGVEYXRhKHBhcnNlOiBib29sZWFuLCBrZXk6IHN0cmluZykge1xyXG4gIGlmIChwYXJzZSkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgcmV0dXJuIEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oa2V5KSk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICByZXR1cm4gbnVsbFxyXG4gICAgfVxyXG4gIH0gZWxzZSB7XHJcbiAgICByZXR1cm4gbG9jYWxTdG9yYWdlLmdldEl0ZW0oa2V5KTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBzZXRDYWNoZURhdGEoa2V5OiBzdHJpbmcsIHZhbHVlOiBzdHJpbmcpIHtcclxuICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShrZXksIHZhbHVlKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGRlbGV0ZUNhY2hlRGF0YShrZXk6IHN0cmluZykge1xyXG4gIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKGtleSk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBpc0pzb25TdHJpbmcoc3RyKSB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IGpzb24gPSBKU09OLnBhcnNlKHN0cik7XHJcbiAgICByZXR1cm4gKHR5cGVvZiBqc29uID09PSAnb2JqZWN0Jyk7XHJcbiAgfSBjYXRjaCAoZSkge1xyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGdldEVuY291bnRlclByb3ZpZGVyVVVJRCgpIHtcclxuICByZXR1cm4gZ2V0Q2FjaGVEYXRhKHRydWUsIHZpc2l0VHlwZXMuVklTSVRfTk9URV9QUk9WSURFUikuZW5jb3VudGVyUHJvdmlkZXJzWzBdLnByb3ZpZGVyLnV1aWQ7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRFbmNvdW50ZXJVVUlEKCkge1xyXG4gIHJldHVybiBnZXRDYWNoZURhdGEodHJ1ZSwgdmlzaXRUeXBlcy5WSVNJVF9OT1RFX1BST1ZJREVSKS51dWlkO1xyXG59XHJcblxyXG4vKipcclxuICAqIENoZWNrIGhvdyBvbGQgdGhlIGRhdGUgaXMgZnJvbSBub3dcclxuICAqIEBwYXJhbSB7c3RyaW5nfSBkYXRhIC0gRGF0ZSBpbiBzdHJpbmcgZm9ybWF0XHJcbiAgKiBAcmV0dXJuIHtzdHJpbmd9IC0gUmV0dXJucyBob3cgb2xkIHRoZSBkYXRlIGlzIGZyb20gbm93XHJcbiAgKi9cclxuZXhwb3J0IGZ1bmN0aW9uIGNoZWNrSWZEYXRlT2xkVGhhbk9uZURheShkYXRhOiBzdHJpbmcpIHtcclxuICBsZXQgaG91cnMgPSBtb21lbnQoZGF0YSkuZGlmZihtb21lbnQoKSwgJ2hvdXJzJyk7XHJcbiAgbGV0IG1pbnV0ZXMgPSBtb21lbnQoZGF0YSkuZGlmZihtb21lbnQoKSwgJ21pbnV0ZXMnKTtcclxuICBtaW51dGVzID0gbWludXRlcyAtIChob3VycyAqIDYwKTtcclxuICBsZXQgcmVzU3RyaW5nID0gXCJcIjtcclxuICBpZiAoaG91cnMgPj0gMjQpIHtcclxuICAgIHJlc1N0cmluZyA9IG1vbWVudChkYXRhKS5mb3JtYXQoJ0REIE1NTSwgWVlZWSBoaDptbSBBJyk7XHJcbiAgfSBlbHNlIHtcclxuICAgIGlmIChob3VycyA+IDEpIHtcclxuICAgICAgcmVzU3RyaW5nICs9IGhvdXJzICsgXCIgSG91cnNcIjtcclxuICAgIH0gZWxzZSBpZihob3VycyA9PT0gMSkge1xyXG4gICAgICByZXNTdHJpbmcgKz0gaG91cnMgKyBcIiBIb3VyXCI7XHJcbiAgICB9XHJcbiAgICBpZiAobWludXRlcyA8IDApIHtcclxuICAgICAgcmVzU3RyaW5nID0gYER1ZSA6ICR7bW9tZW50KGRhdGEpLmZvcm1hdCgnREQgTU1NLCBZWVlZIGhoOm1tIEEnKX1gO1xyXG4gICAgfSBlbHNlIGlmIChtaW51dGVzID09PSAxKXtcclxuICAgICAgcmVzU3RyaW5nICs9IFwiIFwiICsgbWludXRlcyArIFwiIE1pbnV0ZVwiXHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXNTdHJpbmcgKz0gXCIgXCIgKyBtaW51dGVzICsgXCIgTWludXRlc1wiXHJcbiAgICB9XHJcbiAgfVxyXG4gIHJldHVybiByZXNTdHJpbmcudHJpbSgpO1xyXG59XHJcbi8qKlxyXG4gICogQ29tcGFyZSBkYXRhIGZvciBzb3J0aW5nXHJcbiAgKiBAcGFyYW0ge251bWJlcnxzdHJpbmd9IGFcclxuICAqIEBwYXJhbSB7bnVtYmVyfHN0cmluZ30gYlxyXG4gICogQHBhcmFtIHtib29sZWFufSBpc0FzY1xyXG4gICogQHJldHVybiB7bnVtYmVyfSAtIFJldHVybnMgb3JkZXIgYXMgMSBvciAtMVxyXG4gICovXHJcbmV4cG9ydCBmdW5jdGlvbiBjb21wYXJlKGE6IG51bWJlciB8IHN0cmluZywgYjogbnVtYmVyIHwgc3RyaW5nLCBpc0FzYzogYm9vbGVhbikge1xyXG4gIHJldHVybiAoYSA8IGIgPyAtMSA6IDEpICogKGlzQXNjID8gMSA6IC0xKTtcclxufVxyXG5cclxuLyoqXHJcbiogR2V0IHNwZWNpYWxpdHlcclxuKiBAcGFyYW0ge1Byb3ZpZGVyQXR0cmlidXRlTW9kZWxbXX0gYXR0ciAtIEFycmF5IG9mIHByb3ZpZGVyIGF0dHJpYnV0ZXNcclxuKiBAcmV0dXJuIHtzdHJpbmd9IC0gU3BlY2lhbGl0eVxyXG4qL1xyXG5leHBvcnQgZnVuY3Rpb24gZ2V0U3BlY2lhbGl6YXRpb24oYXR0cjogUHJvdmlkZXJBdHRyaWJ1dGVNb2RlbFtdID0gW10pOiBzdHJpbmcge1xyXG4gIGxldCBzcGVjaWFsaXphdGlvbiA9ICcnO1xyXG4gIGZvciAoY29uc3QgYSBvZiBhdHRyKSB7XHJcbiAgICBpZiAoYS5hdHRyaWJ1dGVUeXBlLnV1aWQgPT0gJ2VkMTcxNWY1LTkzZTItNDA0ZS1iM2M5LTJhMmQ5NjAwZjA2MicgJiYgIWEudm9pZGVkKSB7XHJcbiAgICAgIHNwZWNpYWxpemF0aW9uID0gYS52YWx1ZTtcclxuICAgICAgYnJlYWs7XHJcbiAgICB9XHJcbiAgfVxyXG4gIHJldHVybiBzcGVjaWFsaXphdGlvbjtcclxufVxyXG5cclxuLyoqXHJcbiogUmV0cmlldmUgdGhlIGFwcHJvcHJpYXRlIGxhbmd1YWdlIHZhbHVlIGZyb20gYW4gZWxlbWVudC5cclxuKiBAcGFyYW0ge2FueX0gZWxlbWVudCAtIEFuIG9iamVjdCBjb250YWluaW5nIGBsYW5nYCBhbmQgYG5hbWVgLlxyXG4qIEByZXR1cm4ge3N0cmluZ30gLSBUaGUgdmFsdWUgaW4gdGhlIHNlbGVjdGVkIGxhbmd1YWdlIG9yIHRoZSBmaXJzdCBhdmFpbGFibGUgb25lLlxyXG4qIERlZmF1bHRzIHRvIGBlbGVtZW50Lm5hbWVgIGlmIG5vIGxhbmd1YWdlIHZhbHVlIGlzIGZvdW5kLlxyXG4qL1xyXG5pbnRlcmZhY2UgRWxlbWVudExhbmcge1xyXG4gIFtrZXk6IHN0cmluZ106IHN0cmluZzsgLy8gUmVwcmVzZW50cyBsYW5ndWFnZSBjb2RlIHRvIHN0cmluZyBtYXBwaW5nc1xyXG59XHJcblxyXG5pbnRlcmZhY2UgRWxlbWVudCB7XHJcbiAgbGFuZzogRWxlbWVudExhbmc7XHJcbiAgbmFtZTogc3RyaW5nO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0RmllbGRWYWx1ZUJ5TGFuZ3VhZ2UoZWxlbWVudDogRWxlbWVudCB8IG51bGwgfCB1bmRlZmluZWQpOiBzdHJpbmcge1xyXG4gIGNvbnN0IHNlbGVjdGVkTGFuZ3VhZ2UgPSBnZXRDYWNoZURhdGEoZmFsc2UsIGxhbmd1YWdlcy5TRUxFQ1RFRF9MQU5HVUFHRSkgYXMgc3RyaW5nO1xyXG5cclxuICAvLyBDaGVjayBpZiBzZWxlY3RlZCBsYW5ndWFnZSBleGlzdHMgaW4gdGhlIGxhbmcgb2JqZWN0IGFuZCBpcyBub3QgZW1wdHlcclxuICBpZiAoZWxlbWVudD8ubGFuZz8uW3NlbGVjdGVkTGFuZ3VhZ2VdPy50cmltKCkpIHtcclxuICAgIHJldHVybiBlbGVtZW50Lmxhbmdbc2VsZWN0ZWRMYW5ndWFnZV0udHJpbSgpO1xyXG4gIH1cclxuXHJcbiAgLy8gUmV0dXJuIHRoZSBmaXJzdCBub24tZW1wdHkgbGFuZ3VhZ2UgdmFsdWVcclxuICBmb3IgKGNvbnN0IGxhbmdWYWx1ZSBvZiBPYmplY3QudmFsdWVzKGVsZW1lbnQ/LmxhbmcgfHwge30pKSB7XHJcbiAgICBpZiAobGFuZ1ZhbHVlLnRyaW0oKSkge1xyXG4gICAgICByZXR1cm4gbGFuZ1ZhbHVlLnRyaW0oKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vIEZhbGxiYWNrIHRvIGVsZW1lbnQubmFtZSBpZiBubyB2YWxpZCBsYW5ndWFnZSB2YWx1ZSBmb3VuZCBvciBlbGVtZW50IGlzIGludmFsaWRcclxuICByZXR1cm4gZWxlbWVudD8ubmFtZSB8fCBcIlwiO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gY2FsY3VsYXRlQk1JKHZpdGFsczogYW55LCB2aXRhbE9iczogYW55LCBfbG9jYWxlOiBzdHJpbmcgPSAnZW4nKSB7XHJcbiAgY29uc3QgaGVpZ2h0VVVJRCA9IHZpdGFscz8uZmluZCgodjogYW55KSA9PiB2LmtleSA9PT0gJ2hlaWdodF9jbScpPy51dWlkO1xyXG4gIGNvbnN0IHdlaWdodFVVSUQgPSB2aXRhbHM/LmZpbmQoKHY6IGFueSkgPT4gdi5rZXkgPT09ICd3ZWlnaHRfa2cnKT8udXVpZDtcclxuICBsZXQgaGVpZ2h0ID0gbnVsbCwgd2VpZ2h0ID0gbnVsbDtcclxuICBpZihoZWlnaHRVVUlEICYmIHdlaWdodFVVSUQpIHtcclxuICAgIGhlaWdodCA9IHZpdGFsT2JzLmZpbmQoKGU6IHsgY29uY2VwdDogeyB1dWlkOiBhbnk7IH07IH0pID0+IGUuY29uY2VwdC51dWlkID09PSBoZWlnaHRVVUlEKT8udmFsdWU7XHJcbiAgICB3ZWlnaHQgPSB2aXRhbE9icy5maW5kKChlOiB7IGNvbmNlcHQ6IHsgdXVpZDogYW55OyB9OyB9KSA9PiBlLmNvbmNlcHQudXVpZCA9PT0gd2VpZ2h0VVVJRCk/LnZhbHVlO1xyXG4gIH1cclxuICBpZihoZWlnaHQgJiYgd2VpZ2h0KSB7XHJcbiAgICBjb25zdCBkZWNpbWFsUGlwZSA9IG5ldyBEZWNpbWFsUGlwZShfbG9jYWxlKVxyXG4gICAgcmV0dXJuIGRlY2ltYWxQaXBlLnRyYW5zZm9ybSh3ZWlnaHQgLyAoKGhlaWdodC8xMDApICogKGhlaWdodC8xMDApKSwgXCIxLjItMlwiKVxyXG4gIH0gIFxyXG4gIHJldHVybiBudWxsO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0Q2FsbER1cmF0aW9uKGdpdmVuX3NlY29uZHM6IG51bWJlcil7XHJcbiAgbGV0IGRhdGVPYmogPSBuZXcgRGF0ZShnaXZlbl9zZWNvbmRzICogMTAwMCk7XHJcbiAgbGV0IGhvdXJzID0gZGF0ZU9iai5nZXRVVENIb3VycygpO1xyXG4gIGxldCBtaW51dGVzID0gZGF0ZU9iai5nZXRVVENNaW51dGVzKCk7XHJcbiAgbGV0IHNlY29uZHMgPSBkYXRlT2JqLmdldFNlY29uZHMoKTtcclxuICByZXR1cm4gaG91cnMudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAnMCcpICsgJzonICsgXHJcbiAgICAgIG1pbnV0ZXMudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAnMCcpICsgJzonICsgXHJcbiAgICAgIHNlY29uZHMudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAnMCcpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gYXV0b0dyb3dUZXh0Wm9uZShlOmFueSkge1xyXG4gIGUudGFyZ2V0LnN0eWxlLmhlaWdodCA9IFwiMHB4XCI7XHJcbiAgZS50YXJnZXQuc3R5bGUuaGVpZ2h0ID0gKGUudGFyZ2V0LnNjcm9sbEhlaWdodCs1KStcInB4XCI7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBhdXRvR3Jvd0FsbFRleHRBcmVhWm9uZShlOiBIVE1MVGV4dEFyZWFFbGVtZW50W10pIHtcclxuICBlLmZvckVhY2goZWxlbWVudCA9PiB7XHJcbiAgICBlbGVtZW50LnN0eWxlLmhlaWdodCA9IChlbGVtZW50LnNjcm9sbEhlaWdodCs1KStcInB4XCI7XHJcbiAgfSk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBvYnNTdHJpbmdpZnkob2JzOiBhbnkpOiBzdHJpbmcge1xyXG4gIHRyeSB7XHJcbiAgICBkZWxldGUgb2JzWyd1dWlkJ107XHJcbiAgICBPYmplY3Qua2V5cyhvYnMpLmZvckVhY2goKGspID0+IG9ic1trXSA9PSBudWxsICYmIGRlbGV0ZSBvYnNba10pO1xyXG4gICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KG9icylcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgcmV0dXJuIFwiXCJcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBvYnNQYXJzZShvYnM6IHN0cmluZywgdXVpZDogc3RyaW5nID0gXCJcIik6IG9iamVjdCB7XHJcbiAgdHJ5IHtcclxuICAgIGlmKHV1aWQpXHJcbiAgICAgIHJldHVybiB7IHV1aWQ6IHV1aWQsIC4uLkpTT04ucGFyc2Uob2JzKSB9XHJcbiAgICBlbHNlXHJcbiAgICAgIHJldHVybiB7IC4uLkpTT04ucGFyc2Uob2JzKSB9XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIHJldHVybiB7IHV1aWQ6IHV1aWQgfVxyXG4gIH1cclxufSJdfQ==