import { languages, visitTypes } from "../config/constant";
// import * as moment from 'moment';
import moment from 'moment';
import { DecimalPipe } from "@angular/common";
// import { environment } from "../../../../src/environments/environment";
export function getCacheData(parse, key) {
    if (parse) {
        try {
            return JSON.parse(localStorage.getItem(key));
        }
        catch (error) {
            return null;
        }
    }
    else {
        return localStorage.getItem(key);
    }
}
export function setCacheData(key, value) {
    localStorage.setItem(key, value);
}
export function deleteCacheData(key) {
    localStorage.removeItem(key);
}
export function isJsonString(str) {
    try {
        const json = JSON.parse(str);
        return (typeof json === 'object');
    }
    catch (e) {
        return false;
    }
}
export function getEncounterProviderUUID() {
    return getCacheData(true, visitTypes.VISIT_NOTE_PROVIDER).encounterProviders[0].provider.uuid;
}
export function getEncounterUUID() {
    return getCacheData(true, visitTypes.VISIT_NOTE_PROVIDER).uuid;
}
/**
  * Check how old the date is from now
  * @param {string} data - Date in string format
  * @return {string} - Returns how old the date is from now
  */
export function checkIfDateOldThanOneDay(data) {
    let hours = moment(data).diff(moment(), 'hours');
    let minutes = moment(data).diff(moment(), 'minutes');
    minutes = minutes - (hours * 60);
    let resString = "";
    if (hours >= 24) {
        resString = moment(data).format('DD MMM, YYYY hh:mm A');
    }
    else {
        if (hours > 1) {
            resString += hours + " Hours";
        }
        else if (hours === 1) {
            resString += hours + " Hour";
        }
        if (minutes < 0) {
            resString = `Due : ${moment(data).format('DD MMM, YYYY hh:mm A')}`;
        }
        else if (minutes === 1) {
            resString += " " + minutes + " Minute";
        }
        else {
            resString += " " + minutes + " Minutes";
        }
    }
    return resString.trim();
}
/**
  * Compare data for sorting
  * @param {number|string} a
  * @param {number|string} b
  * @param {boolean} isAsc
  * @return {number} - Returns order as 1 or -1
  */
export function compare(a, b, isAsc) {
    return (a < b ? -1 : 1) * (isAsc ? 1 : -1);
}
/**
* Get speciality
* @param {ProviderAttributeModel[]} attr - Array of provider attributes
* @return {string} - Speciality
*/
export function getSpecialization(attr = []) {
    let specialization = '';
    for (const a of attr) {
        if (a.attributeType.uuid == 'ed1715f5-93e2-404e-b3c9-2a2d9600f062' && !a.voided) {
            specialization = a.value;
            break;
        }
    }
    return specialization;
}
export function getFieldValueByLanguage(element) {
    const selectedLanguage = getCacheData(false, languages.SELECTED_LANGUAGE);
    // Check if selected language exists in the lang object and is not empty
    if (element?.lang?.[selectedLanguage]?.trim()) {
        return element.lang[selectedLanguage].trim();
    }
    // Return the first non-empty language value
    for (const langValue of Object.values(element?.lang || {})) {
        if (langValue.trim()) {
            return langValue.trim();
        }
    }
    // Fallback to element.name if no valid language value found or element is invalid
    return element?.name || "";
}
export function calculateBMI(vitals, vitalObs, _locale = 'en') {
    const heightUUID = vitals?.find((v) => v.key === 'height_cm')?.uuid;
    const weightUUID = vitals?.find((v) => v.key === 'weight_kg')?.uuid;
    let height = null, weight = null;
    if (heightUUID && weightUUID) {
        height = vitalObs.find((e) => e.concept.uuid === heightUUID)?.value;
        weight = vitalObs.find((e) => e.concept.uuid === weightUUID)?.value;
    }
    if (height && weight) {
        const decimalPipe = new DecimalPipe(_locale);
        return decimalPipe.transform(weight / ((height / 100) * (height / 100)), "1.2-2");
    }
    return null;
}
export function isFeaturePresent(featureName, notInclude = false) {
    const featureList = ['followUpType', 'tnmStaging', 'referralFacility', 'priorityOfReferral', 'follow-up-instruction', 'doctor-recommendation'];
    if (notInclude)
        return !featureList.includes(featureName);
    return featureList.includes(featureName);
}
export function getCallDuration(given_seconds) {
    let dateObj = new Date(given_seconds * 1000);
    let hours = dateObj.getUTCHours();
    let minutes = dateObj.getUTCMinutes();
    let seconds = dateObj.getSeconds();
    return hours.toString().padStart(2, '0') + ':' +
        minutes.toString().padStart(2, '0') + ':' +
        seconds.toString().padStart(2, '0');
}
export function autoGrowTextZone(e) {
    e.target.style.height = "0px";
    e.target.style.height = (e.target.scrollHeight + 5) + "px";
}
export function autoGrowAllTextAreaZone(e) {
    e.forEach(element => {
        element.style.height = (element.scrollHeight + 5) + "px";
    });
}
export function obsStringify(obs) {
    try {
        delete obs['uuid'];
        Object.keys(obs).forEach((k) => obs[k] == null && delete obs[k]);
        return JSON.stringify(obs);
    }
    catch (error) {
        return "";
    }
}
export function obsParse(obs, uuid = "") {
    try {
        if (uuid)
            return { uuid: uuid, ...JSON.parse(obs) };
        else
            return { ...JSON.parse(obs) };
    }
    catch (error) {
        return { uuid: uuid };
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbGl0eS1mdW5jdGlvbnMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9saWItcHJlc2NpcHRpb24vc3JjL2xpYi91dGlscy91dGlsaXR5LWZ1bmN0aW9ucy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBQzNELG9DQUFvQztBQUNwQyxPQUFPLE1BQU0sTUFBTSxRQUFRLENBQUM7QUFFNUIsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQzlDLDBFQUEwRTtBQUUxRSxNQUFNLFVBQVUsWUFBWSxDQUFDLEtBQWMsRUFBRSxHQUFXO0lBQ3RELElBQUksS0FBSyxFQUFFO1FBQ1QsSUFBSTtZQUNGLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxZQUFZLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7U0FDOUM7UUFBQyxPQUFPLEtBQUssRUFBRTtZQUNkLE9BQU8sSUFBSSxDQUFBO1NBQ1o7S0FDRjtTQUFNO1FBQ0wsT0FBTyxZQUFZLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0tBQ2xDO0FBQ0gsQ0FBQztBQUVELE1BQU0sVUFBVSxZQUFZLENBQUMsR0FBVyxFQUFFLEtBQWE7SUFDckQsWUFBWSxDQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUUsS0FBSyxDQUFDLENBQUM7QUFDbkMsQ0FBQztBQUVELE1BQU0sVUFBVSxlQUFlLENBQUMsR0FBVztJQUN6QyxZQUFZLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0FBQy9CLENBQUM7QUFFRCxNQUFNLFVBQVUsWUFBWSxDQUFDLEdBQUc7SUFDOUIsSUFBSTtRQUNGLE1BQU0sSUFBSSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDN0IsT0FBTyxDQUFDLE9BQU8sSUFBSSxLQUFLLFFB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R0FBVyxFQUFFLE9BQWUsRUFBRTtJQUNyRCxJQUFJO1FBQ0YsSUFBRyxJQUFJO1lBQ0wsT0FBTyxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUE7O1lBRXpDLE9BQU8sRUFBRSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQTtLQUNoQztJQUFDLE9BQU8sS0FBSyxFQUFFO1FBQ2QsT0FBTyxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsQ0FBQTtLQUN0QjtBQUNILENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBsYW5ndWFnZXMsIHZpc2l0VHlwZXMgfSBmcm9tIFwiLi4vY29uZmlnL2NvbnN0YW50XCI7XHJcbi8vIGltcG9ydCAqIGFzIG1vbWVudCBmcm9tICdtb21lbnQnO1xyXG5pbXBvcnQgbW9tZW50IGZyb20gJ21vbWVudCc7XHJcbmltcG9ydCB7IFByb3ZpZGVyQXR0cmlidXRlTW9kZWwgfSBmcm9tIFwiLi4vbW9kZWwvbW9kZWxcIjtcclxuaW1wb3J0IHsgRGVjaW1hbFBpcGUgfSBmcm9tIFwiQGFuZ3VsYXIvY29tbW9uXCI7XHJcbi8vIGltcG9ydCB7IGVudmlyb25tZW50IH0gZnJvbSBcIi4uLy4uLy4uLy4uL3NyYy9lbnZpcm9ubWVudHMvZW52aXJvbm1lbnRcIjtcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRDYWNoZURhdGEocGFyc2U6IGJvb2xlYW4sIGtleTogc3RyaW5nKSB7XHJcbiAgaWYgKHBhcnNlKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICByZXR1cm4gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbShrZXkpKTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIHJldHVybiBudWxsXHJcbiAgICB9XHJcbiAgfSBlbHNlIHtcclxuICAgIHJldHVybiBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShrZXkpO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHNldENhY2hlRGF0YShrZXk6IHN0cmluZywgdmFsdWU6IHN0cmluZykge1xyXG4gIGxvY2FsU3RvcmFnZS5zZXRJdGVtKGtleSwgdmFsdWUpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZGVsZXRlQ2FjaGVEYXRhKGtleTogc3RyaW5nKSB7XHJcbiAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oa2V5KTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGlzSnNvblN0cmluZyhzdHIpIHtcclxuICB0cnkge1xyXG4gICAgY29uc3QganNvbiA9IEpTT04ucGFyc2Uoc3RyKTtcclxuICAgIHJldHVybiAodHlwZW9mIGpzb24gPT09ICdvYmplY3QnKTtcclxuICB9IGNhdGNoIChlKSB7XHJcbiAgICByZXR1cm4gZmFsc2U7XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0RW5jb3VudGVyUHJvdmlkZXJVVUlEKCkge1xyXG4gIHJldHVybiBnZXRDYWNoZURhdGEodHJ1ZSwgdmlzaXRUeXBlcy5WSVNJVF9OT1RFX1BST1ZJREVSKS5lbmNvdW50ZXJQcm92aWRlcnNbMF0ucHJvdmlkZXIudXVpZDtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGdldEVuY291bnRlclVVSUQoKSB7XHJcbiAgcmV0dXJuIGdldENhY2hlRGF0YSh0cnVlLCB2aXNpdFR5cGVzLlZJU0lUX05PVEVfUFJPVklERVIpLnV1aWQ7XHJcbn1cclxuXHJcbi8qKlxyXG4gICogQ2hlY2sgaG93IG9sZCB0aGUgZGF0ZSBpcyBmcm9tIG5vd1xyXG4gICogQHBhcmFtIHtzdHJpbmd9IGRhdGEgLSBEYXRlIGluIHN0cmluZyBmb3JtYXRcclxuICAqIEByZXR1cm4ge3N0cmluZ30gLSBSZXR1cm5zIGhvdyBvbGQgdGhlIGRhdGUgaXMgZnJvbSBub3dcclxuICAqL1xyXG5leHBvcnQgZnVuY3Rpb24gY2hlY2tJZkRhdGVPbGRUaGFuT25lRGF5KGRhdGE6IHN0cmluZykge1xyXG4gIGxldCBob3VycyA9IG1vbWVudChkYXRhKS5kaWZmKG1vbWVudCgpLCAnaG91cnMnKTtcclxuICBsZXQgbWludXRlcyA9IG1vbWVudChkYXRhKS5kaWZmKG1vbWVudCgpLCAnbWludXRlcycpO1xyXG4gIG1pbnV0ZXMgPSBtaW51dGVzIC0gKGhvdXJzICogNjApO1xyXG4gIGxldCByZXNTdHJpbmcgPSBcIlwiO1xyXG4gIGlmIChob3VycyA+PSAyNCkge1xyXG4gICAgcmVzU3RyaW5nID0gbW9tZW50KGRhdGEpLmZvcm1hdCgnREQgTU1NLCBZWVlZIGhoOm1tIEEnKTtcclxuICB9IGVsc2Uge1xyXG4gICAgaWYgKGhvdXJzID4gMSkge1xyXG4gICAgICByZXNTdHJpbmcgKz0gaG91cnMgKyBcIiBIb3Vyc1wiO1xyXG4gICAgfSBlbHNlIGlmKGhvdXJzID09PSAxKSB7XHJcbiAgICAgIHJlc1N0cmluZyArPSBob3VycyArIFwiIEhvdXJcIjtcclxuICAgIH1cclxuICAgIGlmIChtaW51dGVzIDwgMCkge1xyXG4gICAgICByZXNTdHJpbmcgPSBgRHVlIDogJHttb21lbnQoZGF0YSkuZm9ybWF0KCdERCBNTU0sIFlZWVkgaGg6bW0gQScpfWA7XHJcbiAgICB9IGVsc2UgaWYgKG1pbnV0ZXMgPT09IDEpe1xyXG4gICAgICByZXNTdHJpbmcgKz0gXCIgXCIgKyBtaW51dGVzICsgXCIgTWludXRlXCJcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJlc1N0cmluZyArPSBcIiBcIiArIG1pbnV0ZXMgKyBcIiBNaW51dGVzXCJcclxuICAgIH1cclxuICB9XHJcbiAgcmV0dXJuIHJlc1N0cmluZy50cmltKCk7XHJcbn1cclxuLyoqXHJcbiAgKiBDb21wYXJlIGRhdGEgZm9yIHNvcnRpbmdcclxuICAqIEBwYXJhbSB7bnVtYmVyfHN0cmluZ30gYVxyXG4gICogQHBhcmFtIHtudW1iZXJ8c3RyaW5nfSBiXHJcbiAgKiBAcGFyYW0ge2Jvb2xlYW59IGlzQXNjXHJcbiAgKiBAcmV0dXJuIHtudW1iZXJ9IC0gUmV0dXJucyBvcmRlciBhcyAxIG9yIC0xXHJcbiAgKi9cclxuZXhwb3J0IGZ1bmN0aW9uIGNvbXBhcmUoYTogbnVtYmVyIHwgc3RyaW5nLCBiOiBudW1iZXIgfCBzdHJpbmcsIGlzQXNjOiBib29sZWFuKSB7XHJcbiAgcmV0dXJuIChhIDwgYiA/IC0xIDogMSkgKiAoaXNBc2MgPyAxIDogLTEpO1xyXG59XHJcblxyXG4vKipcclxuKiBHZXQgc3BlY2lhbGl0eVxyXG4qIEBwYXJhbSB7UHJvdmlkZXJBdHRyaWJ1dGVNb2RlbFtdfSBhdHRyIC0gQXJyYXkgb2YgcHJvdmlkZXIgYXR0cmlidXRlc1xyXG4qIEByZXR1cm4ge3N0cmluZ30gLSBTcGVjaWFsaXR5XHJcbiovXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRTcGVjaWFsaXphdGlvbihhdHRyOiBQcm92aWRlckF0dHJpYnV0ZU1vZGVsW10gPSBbXSk6IHN0cmluZyB7XHJcbiAgbGV0IHNwZWNpYWxpemF0aW9uID0gJyc7XHJcbiAgZm9yIChjb25zdCBhIG9mIGF0dHIpIHtcclxuICAgIGlmIChhLmF0dHJpYnV0ZVR5cGUudXVpZCA9PSAnZWQxNzE1ZjUtOTNlMi00MDRlLWIzYzktMmEyZDk2MDBmMDYyJyAmJiAhYS52b2lkZWQpIHtcclxuICAgICAgc3BlY2lhbGl6YXRpb24gPSBhLnZhbHVlO1xyXG4gICAgICBicmVhaztcclxuICAgIH1cclxuICB9XHJcbiAgcmV0dXJuIHNwZWNpYWxpemF0aW9uO1xyXG59XHJcblxyXG4vKipcclxuKiBSZXRyaWV2ZSB0aGUgYXBwcm9wcmlhdGUgbGFuZ3VhZ2UgdmFsdWUgZnJvbSBhbiBlbGVtZW50LlxyXG4qIEBwYXJhbSB7YW55fSBlbGVtZW50IC0gQW4gb2JqZWN0IGNvbnRhaW5pbmcgYGxhbmdgIGFuZCBgbmFtZWAuXHJcbiogQHJldHVybiB7c3RyaW5nfSAtIFRoZSB2YWx1ZSBpbiB0aGUgc2VsZWN0ZWQgbGFuZ3VhZ2Ugb3IgdGhlIGZpcnN0IGF2YWlsYWJsZSBvbmUuXHJcbiogRGVmYXVsdHMgdG8gYGVsZW1lbnQubmFtZWAgaWYgbm8gbGFuZ3VhZ2UgdmFsdWUgaXMgZm91bmQuXHJcbiovXHJcbmludGVyZmFjZSBFbGVtZW50TGFuZyB7XHJcbiAgW2tleTogc3RyaW5nXTogc3RyaW5nOyAvLyBSZXByZXNlbnRzIGxhbmd1YWdlIGNvZGUgdG8gc3RyaW5nIG1hcHBpbmdzXHJcbn1cclxuXHJcbmludGVyZmFjZSBFbGVtZW50IHtcclxuICBsYW5nOiBFbGVtZW50TGFuZztcclxuICBuYW1lOiBzdHJpbmc7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRGaWVsZFZhbHVlQnlMYW5ndWFnZShlbGVtZW50OiBFbGVtZW50IHwgbnVsbCB8IHVuZGVmaW5lZCk6IHN0cmluZyB7XHJcbiAgY29uc3Qgc2VsZWN0ZWRMYW5ndWFnZSA9IGdldENhY2hlRGF0YShmYWxzZSwgbGFuZ3VhZ2VzLlNFTEVDVEVEX0xBTkdVQUdFKSBhcyBzdHJpbmc7XHJcblxyXG4gIC8vIENoZWNrIGlmIHNlbGVjdGVkIGxhbmd1YWdlIGV4aXN0cyBpbiB0aGUgbGFuZyBvYmplY3QgYW5kIGlzIG5vdCBlbXB0eVxyXG4gIGlmIChlbGVtZW50Py5sYW5nPy5bc2VsZWN0ZWRMYW5ndWFnZV0/LnRyaW0oKSkge1xyXG4gICAgcmV0dXJuIGVsZW1lbnQubGFuZ1tzZWxlY3RlZExhbmd1YWdlXS50cmltKCk7XHJcbiAgfVxyXG5cclxuICAvLyBSZXR1cm4gdGhlIGZpcnN0IG5vbi1lbXB0eSBsYW5ndWFnZSB2YWx1ZVxyXG4gIGZvciAoY29uc3QgbGFuZ1ZhbHVlIG9mIE9iamVjdC52YWx1ZXMoZWxlbWVudD8ubGFuZyB8fCB7fSkpIHtcclxuICAgIGlmIChsYW5nVmFsdWUudHJpbSgpKSB7XHJcbiAgICAgIHJldHVybiBsYW5nVmFsdWUudHJpbSgpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8gRmFsbGJhY2sgdG8gZWxlbWVudC5uYW1lIGlmIG5vIHZhbGlkIGxhbmd1YWdlIHZhbHVlIGZvdW5kIG9yIGVsZW1lbnQgaXMgaW52YWxpZFxyXG4gIHJldHVybiBlbGVtZW50Py5uYW1lIHx8IFwiXCI7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBjYWxjdWxhdGVCTUkodml0YWxzOiBhbnksIHZpdGFsT2JzOiBhbnksIF9sb2NhbGU6IHN0cmluZyA9ICdlbicpIHtcclxuICBjb25zdCBoZWlnaHRVVUlEID0gdml0YWxzPy5maW5kKCh2OiBhbnkpID0+IHYua2V5ID09PSAnaGVpZ2h0X2NtJyk/LnV1aWQ7XHJcbiAgY29uc3Qgd2VpZ2h0VVVJRCA9IHZpdGFscz8uZmluZCgodjogYW55KSA9PiB2LmtleSA9PT0gJ3dlaWdodF9rZycpPy51dWlkO1xyXG4gIGxldCBoZWlnaHQgPSBudWxsLCB3ZWlnaHQgPSBudWxsO1xyXG4gIGlmKGhlaWdodFVVSUQgJiYgd2VpZ2h0VVVJRCkge1xyXG4gICAgaGVpZ2h0ID0gdml0YWxPYnMuZmluZCgoZTogeyBjb25jZXB0OiB7IHV1aWQ6IGFueTsgfTsgfSkgPT4gZS5jb25jZXB0LnV1aWQgPT09IGhlaWdodFVVSUQpPy52YWx1ZTtcclxuICAgIHdlaWdodCA9IHZpdGFsT2JzLmZpbmQoKGU6IHsgY29uY2VwdDogeyB1dWlkOiBhbnk7IH07IH0pID0+IGUuY29uY2VwdC51dWlkID09PSB3ZWlnaHRVVUlEKT8udmFsdWU7XHJcbiAgfVxyXG4gIGlmKGhlaWdodCAmJiB3ZWlnaHQpIHtcclxuICAgIGNvbnN0IGRlY2ltYWxQaXBlID0gbmV3IERlY2ltYWxQaXBlKF9sb2NhbGUpXHJcbiAgICByZXR1cm4gZGVjaW1hbFBpcGUudHJhbnNmb3JtKHdlaWdodCAvICgoaGVpZ2h0LzEwMCkgKiAoaGVpZ2h0LzEwMCkpLCBcIjEuMi0yXCIpXHJcbiAgfSAgXHJcbiAgcmV0dXJuIG51bGw7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBpc0ZlYXR1cmVQcmVzZW50KGZlYXR1cmVOYW1lOiBzdHJpbmcsIG5vdEluY2x1ZGUgPSBmYWxzZSk6IGJvb2xlYW4ge1xyXG4gIGNvbnN0IGZlYXR1cmVMaXN0ID0gWydmb2xsb3dVcFR5cGUnLCd0bm1TdGFnaW5nJywncmVmZXJyYWxGYWNpbGl0eScsJ3ByaW9yaXR5T2ZSZWZlcnJhbCcsJ2ZvbGxvdy11cC1pbnN0cnVjdGlvbicsJ2RvY3Rvci1yZWNvbW1lbmRhdGlvbiddXHJcbiAgaWYobm90SW5jbHVkZSkgcmV0dXJuICFmZWF0dXJlTGlzdC5pbmNsdWRlcyhmZWF0dXJlTmFtZSk7XHJcbiAgcmV0dXJuIGZlYXR1cmVMaXN0LmluY2x1ZGVzKGZlYXR1cmVOYW1lKTtcclxufVxyXG5cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRDYWxsRHVyYXRpb24oZ2l2ZW5fc2Vjb25kczogbnVtYmVyKXtcclxuICBsZXQgZGF0ZU9iaiA9IG5ldyBEYXRlKGdpdmVuX3NlY29uZHMgKiAxMDAwKTtcclxuICBsZXQgaG91cnMgPSBkYXRlT2JqLmdldFVUQ0hvdXJzKCk7XHJcbiAgbGV0IG1pbnV0ZXMgPSBkYXRlT2JqLmdldFVUQ01pbnV0ZXMoKTtcclxuICBsZXQgc2Vjb25kcyA9IGRhdGVPYmouZ2V0U2Vjb25kcygpO1xyXG4gIHJldHVybiBob3Vycy50b1N0cmluZygpLnBhZFN0YXJ0KDIsICcwJykgKyAnOicgKyBcclxuICAgICAgbWludXRlcy50b1N0cmluZygpLnBhZFN0YXJ0KDIsICcwJykgKyAnOicgKyBcclxuICAgICAgc2Vjb25kcy50b1N0cmluZygpLnBhZFN0YXJ0KDIsICcwJyk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBhdXRvR3Jvd1RleHRab25lKGU6YW55KSB7XHJcbiAgZS50YXJnZXQuc3R5bGUuaGVpZ2h0ID0gXCIwcHhcIjtcclxuICBlLnRhcmdldC5zdHlsZS5oZWlnaHQgPSAoZS50YXJnZXQuc2Nyb2xsSGVpZ2h0KzUpK1wicHhcIjtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGF1dG9Hcm93QWxsVGV4dEFyZWFab25lKGU6IEhUTUxUZXh0QXJlYUVsZW1lbnRbXSkge1xyXG4gIGUuZm9yRWFjaChlbGVtZW50ID0+IHtcclxuICAgIGVsZW1lbnQuc3R5bGUuaGVpZ2h0ID0gKGVsZW1lbnQuc2Nyb2xsSGVpZ2h0KzUpK1wicHhcIjtcclxuICB9KTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIG9ic1N0cmluZ2lmeShvYnM6IGFueSk6IHN0cmluZyB7XHJcbiAgdHJ5IHtcclxuICAgIGRlbGV0ZSBvYnNbJ3V1aWQnXTtcclxuICAgIE9iamVjdC5rZXlzKG9icykuZm9yRWFjaCgoaykgPT4gb2JzW2tdID09IG51bGwgJiYgZGVsZXRlIG9ic1trXSk7XHJcbiAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkob2JzKVxyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICByZXR1cm4gXCJcIlxyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIG9ic1BhcnNlKG9iczogc3RyaW5nLCB1dWlkOiBzdHJpbmcgPSBcIlwiKTogb2JqZWN0IHtcclxuICB0cnkge1xyXG4gICAgaWYodXVpZClcclxuICAgICAgcmV0dXJuIHsgdXVpZDogdXVpZCwgLi4uSlNPTi5wYXJzZShvYnMpIH1cclxuICAgIGVsc2VcclxuICAgICAgcmV0dXJuIHsgLi4uSlNPTi5wYXJzZShvYnMpIH1cclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgcmV0dXJuIHsgdXVpZDogdXVpZCB9XHJcbiAgfVxyXG59Il19